<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MediHom - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./dashboard.css">
</head>
<body class="bg-gray-50 font-sans">

  <!-- Notificaciones -->
  <div id="notifications" class="fixed top-4 right-4 space-y-2 z-50"></div>

  <!-- Header -->
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-14">
        <div class="flex items-center">
          <div class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center mr-3">
            <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
          </div>
          <h1 class="text-lg font-light text-gray-800">MediHom</h1>
        </div>

        <div class="flex items-center space-x-4">
          <span id="userWelcome" class="text-gray-600 text-sm"></span>
          <button id="logoutBtn"
                  class="bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 transition duration-200">
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div id="navigationTabs" class="flex space-x-8"></div>
    </div>
  </nav>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

    <!-- PACIENTE: Rutinas -->
    <section id="routinesSection" class="section">
      <div class="flex justify-between items-center mb-6">
        <h2 id="routinesSectionTitle" class="text-xl font-light text-gray-800">Mis Rutinas de Rehabilitación</h2>
        <button id="selectRoutineBtn"
                class="bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 transition duration-200">
          + Seleccionar Rutina
        </button>
      </div>

      <div id="routinesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Tarjetas de rutinas asignadas -->
      </div>
    </section>

    <!-- PACIENTE: Progreso -->
    <section id="progressSection" class="section hidden">
      <h2 class="text-xl font-light text-gray-800 mb-6">Mi Progreso</h2>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-lg card-minimal p-6">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Estadísticas Generales</h3>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Rutinas Completadas</span>
                <span id="completedRoutines">0/0</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="completedProgress" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Ejercicios Realizados</span>
                <span id="exercisesCount">0</span>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Días Activos</span>
                <span id="activeDays">0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg card-minimal p-6">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Progreso Semanal</h3>
          <div class="chart-container">
            <canvas id="progressChart" width="400" height="200"></canvas>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg card-minimal p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium text-gray-800">Exportar Reportes</h3>
          <div class="space-x-2">
            <button id="exportPDF"
                    class="bg-red-500 text-white px-3 py-2 rounded-md text-sm hover:bg-red-600 transition duration-200">
              Descargar PDF
            </button>
            <button id="exportCSV"
                    class="bg-green-500 text-white px-3 py-2 rounded-md text-sm hover:bg-green-600 transition duration-200">
              Descargar CSV
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- PERFIL -->
    <section id="profileSection" class="section hidden">
      <h2 class="text-xl font-light text-gray-800 mb-6">Mi Perfil</h2>

      <div class="bg-white rounded-lg card-minimal p-6">
        <form id="profileForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-2">Nombre Completo</label>
              <input type="text" id="profileName" class="w-full px-3 py-2 minimal-input rounded-md">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-2">Correo Electrónico</label>
              <input type="email" id="profileEmail" class="w-full px-3 py-2 minimal-input rounded-md">
            </div>
          </div>

          <button type="submit"
                  class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
            Actualizar Perfil
          </button>
        </form>
      </div>
    </section>

    <!-- SOPORTE -->
    <section id="supportSection" class="section hidden">
      <h2 class="text-xl font-light text-gray-800 mb-6">Soporte y Ayuda</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg card-minimal p-6">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Contactar Soporte</h3>
          <form id="supportForm" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-2">Asunto</label>
              <input type="text" id="supportSubject" required class="w-full px-3 py-2 minimal-input rounded-md">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-600 mb-2">Mensaje</label>
              <textarea id="supportMessage" rows="4" required class="w-full px-3 py-2 minimal-input rounded-md"></textarea>
            </div>
            <button type="submit"
                    class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
              Enviar Mensaje
            </button>
          </form>
        </div>

        <div class="bg-white rounded-lg card-minimal p-6">
          <h3 class="text-lg font-medium text-gray-800 mb-4">Preguntas Frecuentes</h3>
          <div class="space-y-4">
            <div class="border-b border-gray-100 pb-4">
              <h4 class="font-medium text-gray-800">¿Cómo inicio una rutina?</h4>
              <p class="text-gray-600 text-sm mt-1">Ve a "Mis Rutinas" y haz clic en cualquier rutina para comenzar.</p>
            </div>
            <div class="border-b border-gray-100 pb-4">
              <h4 class="font-medium text-gray-800">¿Puedo modificar mis ejercicios?</h4>
              <p class="text-gray-600 text-sm mt-1">Contacta a tu terapeuta para ajustar tu plan de rehabilitación.</p>
            </div>
            <div>
              <h4 class="font-medium text-gray-800">¿Cómo veo mi progreso?</h4>
              <p class="text-gray-600 text-sm mt-1">Visita la sección "Progreso" para ver tus estadísticas y gráficas.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- TERAPEUTA -->
    <section id="therapistSection" class="section hidden">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-light text-gray-800">Panel de Terapeuta</h2>
        <button id="createRoutineBtn"
                class="bg-green-600 text-white px-4 py-2 rounded-md text-sm hover:bg-green-700 transition duration-200">
          + Crear Nueva Rutina
        </button>
      </div>

      <!-- Métricas -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-lg card-minimal p-6">
          <p class="text-sm text-gray-500">Rutinas Creadas</p>
          <p id="therapistRoutinesCount" class="text-xl font-light text-gray-800">0</p>
        </div>
        <div class="bg-white rounded-lg card-minimal p-6">
          <p class="text-sm text-gray-500">Pacientes Activos</p>
          <p id="activePatientsCount" class="text-xl font-light text-gray-800">0</p>
        </div>
        <div class="bg-white rounded-lg card-minimal p-6">
          <p class="text-sm text-gray-500">Rutinas Completadas</p>
          <p id="completedTherapistRoutines" class="text-xl font-light text-gray-800">0</p>
        </div>
        <div class="bg-white rounded-lg card-minimal p-6">
          <p class="text-sm text-gray-500">Tasa de Éxito</p>
          <p id="successRate" class="text-xl font-light text-gray-800">0%</p>
        </div>
      </div>

      <!-- Mis Rutinas Creadas -->
      <div class="bg-white rounded-lg card-minimal p-6 mb-8">
        <h3 class="text-lg font-medium text-gray-800 mb-4">Mis Rutinas Creadas</h3>
        <div id="therapistRoutinesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>
    </section>

  </main>

  <!-- MODALES (PACIENTE) -->

  <!-- Seleccionar Rutina -->
  <div id="routineModal"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-lg border border-gray-200 p-6 w-full max-w-2xl max-h-96 overflow-y-auto">
      <h3 class="text-lg font-medium text-gray-800 mb-4">Seleccionar Rutina de Rehabilitación</h3>
      <div id="availableRoutines" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"></div>
      <div class="flex justify-end">
        <button type="button" id="cancelRoutine"
                class="bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 transition duration-200">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Pantalla de Ejercicio Diario -->
  <div id="exerciseScreen"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-lg border border-gray-200 p-8 w-full max-w-2xl">
      <div class="text-center mb-6">
        <h2 id="exerciseTitle" class="text-xl font-light text-gray-800 mb-2"></h2>
        <p id="exerciseDay" class="text-gray-500"></p>
      </div>

      <div class="bg-blue-50 rounded-lg p-6 mb-6">
        <div>
          <h3 id="currentExerciseName" class="text-lg font-medium text-gray-800"></h3>
          <p id="currentExerciseReps" class="text-gray-600"></p>
        </div>
        <div class="flex justify-between text-sm text-gray-600 my-3">
          <span>Duración estimada</span>
          <span id="exerciseDuration"></span>
        </div>
        <div class="bg-white rounded-lg p-4">
          <h4 class="font-medium text-gray-800 mb-2">Instrucciones:</h4>
          <ul id="exerciseInstructions" class="text-sm text-gray-600 space-y-1"></ul>
        </div>
      </div>

      <div class="flex justify-between">
        <button id="cancelExercise"
                class="bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200">
          Cancelar
        </button>
        <button id="completeExercise"
                class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
          Completar Ejercicio
        </button>
      </div>
    </div>
  </div>

  <!-- Detalles de Rutina -->
  <div id="routineDetailsModal"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-lg border border-gray-200 p-6 w-full max-w-lg max-h-96 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h3 id="detailsRoutineName" class="text-lg font-medium text-gray-800"></h3>
        <button id="closeDetailsModal" class="text-gray-400 hover:text-gray-600">✕</button>
      </div>

      <div class="mb-4">
        <div class="bg-green-50 rounded-lg p-4 mb-4">
          <span class="text-green-800 font-medium">¡Rutina Completada!</span>
          <p id="detailsCompletionDate" class="text-green-700 text-sm"></p>
        </div>
        <h4 class="font-medium text-gray-800 mb-3">Ejercicios Realizados:</h4>
        <div id="exerciseDetailsList" class="space-y-2"></div>
      </div>

      <div class="flex justify-end">
        <button id="closeDetailsBtn"
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL (TERAPEUTA) -->

  <!-- Crear Nueva Rutina -->
  <div id="createRoutineModal"
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-lg border border-gray-200 p-6 w-full max-w-4xl max-h-96 overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-light text-gray-800">Crear Nueva Rutina de Rehabilitación</h3>
        <button id="closeCreateRoutineModal" class="text-gray-400 hover:text-gray-600">✕</button>
      </div>

      <form id="createRoutineForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-2">Nombre de la Rutina</label>
            <input type="text" id="routineName" required class="w-full px-3 py-2 minimal-input rounded-md">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-2">Categoría</label>
            <select id="routineCategory" required class="w-full px-3 py-2 minimal-input rounded-md">
              <option value="">Seleccionar categoría</option>
              <option value="Piernas">Piernas</option>
              <option value="Brazos">Brazos</option>
              <option value="Espalda">Espalda</option>
              <option value="Cuello">Cuello</option>
              <option value="General">General</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-2">Dificultad</label>
            <select id="routineDifficulty" required class="w-full px-3 py-2 minimal-input rounded-md">
              <option value="">Seleccionar dificultad</option>
              <option value="Principiante">Principiante</option>
              <option value="Intermedio">Intermedio</option>
              <option value="Avanzado">Avanzado</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-2">Duración Total (minutos)</label>
            <input type="number" id="routineDuration" min="1" max="120" required class="w-full px-3 py-2 minimal-input rounded-md">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-2">Descripción</label>
          <textarea id="routineDescription" rows="3" required class="w-full px-3 py-2 minimal-input rounded-md"
                    placeholder="Describe el objetivo y beneficios de esta rutina..."></textarea>
        </div>

        <!-- Días 1-3 -->
        <div class="space-y-6">
          <div class="border border-gray-200 rounded-lg p-4">
            <h5 class="font-medium text-gray-800 mb-3">Día 1</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <input id="exercise1Name" class="minimal-input rounded-md" placeholder="Nombre del ejercicio" required>
              <input id="exercise1Reps" class="minimal-input rounded-md" placeholder="Repeticiones (ej: 10-15)" required>
              <input id="exercise1Duration" type="number" min="1" max="60" class="minimal-input rounded-md" placeholder="Duración" required>
            </div>
          </div>

          <div class="border border-gray-200 rounded-lg p-4">
            <h5 class="font-medium text-gray-800 mb-3">Día 2</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <input id="exercise2Name" class="minimal-input rounded-md" placeholder="Nombre del ejercicio" required>
              <input id="exercise2Reps" class="minimal-input rounded-md" placeholder="Repeticiones (ej: 8-12)" required>
              <input id="exercise2Duration" type="number" min="1" max="60" class="minimal-input rounded-md" placeholder="Duración" required>
            </div>
          </div>

          <div class="border border-gray-200 rounded-lg p-4">
            <h5 class="font-medium text-gray-800 mb-3">Día 3</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <input id="exercise3Name" class="minimal-input rounded-md" placeholder="Nombre del ejercicio" required>
              <input id="exercise3Reps" class="minimal-input rounded-md" placeholder="Repeticiones (ej: 3x30seg)" required>
              <input id="exercise3Duration" type="number" min="1" max="60" class="minimal-input rounded-md" placeholder="Duración" required>
            </div>
          </div>
        </div>

        <div class="flex justify-end gap-3">
          <button type="button" id="cancelCreateRoutine"
                  class="bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200">Cancelar</button>
          <button type="submit"
                  class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">Crear Rutina</button>
        </div>
      </form>
    </div>
  </div>

  <!-- RUTINAS DE REHABILITACIÓN EN HTML -->
  <script id="rehabRoutines" type="application/json">
[
  {
    "id": "rtn-espalda-lumbar-suave",
    "name": "Espalda (lumbar) — Movilidad suave",
    "category": "Espalda",
    "difficulty": "Principiante",
    "duration": 18,
    "description": "Disminuir rigidez lumbar y mejorar control lumbopélvico.",
    "days": [
      { "name": "Basculación pélvica en supino", "reps": "3×10", "duration": 6,
        "instructions": ["Rodillas flexionadas", "Retroversión pélvica", "Respira profundo"] },
      { "name": "Puente glúteo asistido", "reps": "3×10", "duration": 6,
        "instructions": ["Eleva cadera sin dolor", "Mantén 2s", "Desciende controlado"] },
      { "name": "Gato–camello", "reps": "3×8", "duration": 6,
        "instructions": ["Movimiento lento", "Evita dolor agudo", "Sin rebotes"] }
    ],
    "ownerId": null
  },
  {
    "id": "rtn-cuello-descarga",
    "name": "Cuello — Descarga cervical",
    "category": "Cuello",
    "difficulty": "Intermedio",
    "duration": 15,
    "description": "Reducir tensión cervical y mejorar movilidad sin dolor.",
    "days": [
      { "name": "Inclinaciones laterales activas", "reps": "3×8 por lado", "duration": 5,
        "instructions": ["Rango sin dolor", "Hombros relajados", "Tempo lento"] },
      { "name": "Rotaciones controladas", "reps": "3×8 por lado", "duration": 5,
        "instructions": ["Mirada al frente", "Evita mareo"] },
      { "name": "Isometría cervical suave (mano–frente)", "reps": "3×20s", "duration": 5,
        "instructions": ["Presión 20–30%", "No contener la respiración"] }
    ],
    "ownerId": null
  },
  {
    "id": "rtn-rodilla-control",
    "name": "Rodilla — Control y fortalecimiento leve",
    "category": "Piernas",
    "difficulty": "Principiante",
    "duration": 15,
    "description": "Activación de cuádriceps y control sin impacto.",
    "days": [
      { "name": "Cuádriceps isométrico en extensión", "reps": "5×15s", "duration": 5,
        "instructions": ["Toalla bajo rodilla", "Contracción suave", "Sin dolor"] },
      { "name": "Elevación de pierna recta", "reps": "3×10", "duration": 5,
        "instructions": ["Rodilla extendida", "Sube 30–40°", "Controlado"] },
      { "name": "Mini-sentadilla a silla", "reps": "3×8", "duration": 5,
        "instructions": ["Apoyo en silla", "Rodillas alineadas", "Peso repartido"] }
    ],
    "ownerId": null
  },
  {
    "id": "rtn-hombro-escapular",
    "name": "Hombro — Estabilidad escapular",
    "category": "Brazos",
    "difficulty": "Intermedio",
    "duration": 18,
    "description": "Mejorar control escapular y rango sin dolor.",
    "days": [
      { "name": "Retracción escapular en pared", "reps": "3×10", "duration": 6,
        "instructions": ["Espalda a la pared", "Hombros abajo y atrás"] },
      { "name": "Deslizamientos tipo ‘ángel’", "reps": "3×8", "duration": 6,
        "instructions": ["Codos y muñecas a la pared", "Sube/baja controlado"] },
      { "name": "Rotación externa con banda", "reps": "3×12", "duration": 6,
        "instructions": ["Codo pegado al cuerpo", "Resistencia leve", "Sin compensaciones"] }
    ],
    "ownerId": null
  }
]
  </script>

  <script src="./dashboard.js" defer></script>
</body>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      try {
        // Rutas ABSOLUTAS a la carpeta del proyecto:
        const reg = await navigator.serviceWorker.register('/integradora/serviceWorker.js', {
          scope: '/integradora/'
        });
        console.log('✅ Service Worker registrado con scope:', reg.scope);
      } catch (err) {
        console.error('❌ Error al registrar el Service Worker:', err);
      }
    });
  }
</script>



</html>
